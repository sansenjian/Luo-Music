# luo_music

åŸºäº Vue 3 + Pinia + Electron çš„è·¨å¹³å°éŸ³ä¹æ’­æ”¾å™¨

> âš ï¸ **å·²çŸ¥é—®é¢˜**ï¼šä½¿ç”¨ã€Œæ²‰æµ¸å¼ç¿»è¯‘ã€æµè§ˆå™¨æ’ä»¶å¯èƒ½å¯¼è‡´æ­Œè¯ä¸æ˜¾ç¤ºã€‚å¦‚æœé‡åˆ°æ­Œè¯ä¸æ˜¾ç¤ºçš„é—®é¢˜ï¼Œè¯·å°è¯•ç¦ç”¨è¯¥æ’ä»¶æˆ–å°†å…¶åŠ å…¥ç™½åå•ã€‚

## ğŸš€ å¼€å‘è®¡åˆ’

- [x] è¿›åº¦æ¡æ‹–åŠ¨æ—¶å®æ—¶è¿½è¸ªæ­Œè¯
- [x] å‡çº§ Vite åˆ° v7 ç‰ˆæœ¬
- [x] å‡çº§ Vue åˆ° v3.5 ç‰ˆæœ¬
- [ ] è¿›è¡Œå½•å±æˆ–è€…æˆªå›¾ä¼šå‡ºç°ç™½å±é—®é¢˜
- [x] é‡æ„ playerStore æ¶ˆé™¤ä¸Šå¸ç±»é—®é¢˜
- [x] ä¼˜åŒ–æ­Œè¯æ»šåŠ¨æ€§èƒ½

## åŠŸèƒ½ç‰¹æ€§

### P0 æ ¸å¿ƒåŠŸèƒ½
- âœ… éŸ³ä¹æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾/æš‚åœ/ä¸Šä¸€æ›²/ä¸‹ä¸€æ›²ï¼‰
- âœ… æ’­æ”¾è¿›åº¦æ§åˆ¶ï¼ˆè¿›åº¦æ¡æ‹–åŠ¨/æ—¶é—´æ˜¾ç¤ºï¼‰
- âœ… æ­Œè¯å®æ—¶åŒæ­¥æ˜¾ç¤ºï¼ˆLRC æ ¼å¼è§£æï¼‰
- âœ… æ­Œæ›²æœç´¢ï¼ˆç½‘æ˜“äº‘éŸ³ä¹ APIï¼‰
- âœ… æ’­æ”¾åˆ—è¡¨ç®¡ç†

### P1 å¢å¼ºåŠŸèƒ½
- âœ… éŸ³é‡æ§åˆ¶ï¼ˆæŒä¹…åŒ–ã€æ”¯æŒæ‹–åŠ¨ï¼‰
- âœ… æ’­æ”¾æ¨¡å¼åˆ‡æ¢ï¼ˆé¡ºåº/å¾ªç¯/å•æ›²/éšæœºï¼‰
- âœ… å¤šå±‚æ­Œè¯æ”¯æŒï¼ˆåŸæ–‡/ç¿»è¯‘/ç½—é©¬éŸ³ï¼‰
- âœ… æ­Œè¯ç‚¹å‡»è·³è½¬
- âœ… æ­Œè¯è‡ªåŠ¨æ»šåŠ¨ï¼ˆäºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–ï¼‰
- âœ… å“åº”å¼å¸ƒå±€ï¼ˆæ¡Œé¢ç«¯/ç§»åŠ¨ç«¯é€‚é…ï¼‰
- âœ… æ¡Œé¢åº”ç”¨æ”¯æŒï¼ˆElectronï¼‰
- âœ… æŒ‰é’®åŠ¨ç”»æ•ˆæœï¼ˆAnime.jsï¼‰
- âœ… è¿›åº¦æ¡æ‹–åŠ¨å®šä½
- âœ… Web æµè§ˆå™¨æ”¯æŒï¼ˆChrome/Edge/Firefoxï¼‰

## æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Vue | 3.5+ | å‰ç«¯æ¡†æ¶ |
| Electron | 33.0+ | æ¡Œé¢åº”ç”¨æ¡†æ¶ |
| Pinia | 3.0+ | çŠ¶æ€ç®¡ç† |
| Pinia Plugin Persistedstate | 4.7+ | çŠ¶æ€æŒä¹…åŒ– |
| Axios | 1.6+ | HTTP å®¢æˆ·ç«¯ |
| Vite | 7.0+ | æ„å»ºå·¥å…· |
| Anime.js | 4.0+ | åŠ¨ç”»æ•ˆæœ |
| NeteaseCloudMusicApi Enhanced | 4.30+ | éŸ³ä¹ API æœåŠ¡ |

## ä¾èµ–ç»“æ„è¯´æ˜

é¡¹ç›®é‡‡ç”¨**ä¾èµ–åˆ†ç¦»**ç­–ç•¥ï¼Œä¼˜åŒ– Web éƒ¨ç½²ä½“ç§¯ï¼š

```json
{
  "dependencies": {
    // çº¯ Web ä¾èµ– - Vercel éƒ¨ç½²æ—¶å®‰è£…
    "vue": "^3.5.28",
    "pinia": "^3.0.4",
    "animejs": "^4.3.6"
    // ...
  },
  "devDependencies": {
    // Electron ä¸“å±ä¾èµ– - ä»…å¼€å‘/æ‰“åŒ…æ—¶å®‰è£…
    "electron": "^33.2.1",
    "electron-builder": "^25.1.8",
    "vite-plugin-electron": "^0.29.0"
    // ...
  }
}
```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

| åœºæ™¯ | å®‰è£…å‘½ä»¤ | å®‰è£…çš„ä¾èµ– |
|------|----------|-----------|
| **æœ¬åœ°å¼€å‘** | `npm install` | å…¨éƒ¨ä¾èµ– |
| **Electron æ‰“åŒ…** | `npm install` | å…¨éƒ¨ä¾èµ– |
| **Vercel Web éƒ¨ç½²** | `npm install --production` | ä»… dependencies |

### å®‰è£… Electron ç›¸å…³ä¾èµ–

```bash
# å®‰è£… Electronï¼ˆå¼€å‘ä¾èµ–ï¼‰
npm install -D electron

# å®‰è£… Electron æ‰“åŒ…å·¥å…·
npm install -D electron-builder

# å®‰è£… Vite Electron æ’ä»¶
npm install -D vite-plugin-electron vite-plugin-electron-renderer
```

> **æ³¨æ„**ï¼šElectron ç›¸å…³åŒ…å¿…é¡»æ”¾åœ¨ `devDependencies` ä¸­ï¼Œå¦åˆ™ Vercel éƒ¨ç½²æ—¶ä¼šå®‰è£…ä¸å¿…è¦çš„ä¾èµ–ï¼Œå¯¼è‡´éƒ¨ç½²å¤±è´¥æˆ–ä½“ç§¯è¿‡å¤§ã€‚

## é¡¹ç›®ç»“æ„

```
luo_music/
â”œâ”€â”€ api/              # Vercel Serverless Function
â”‚   â””â”€â”€ index.js      # API å…¥å£
â”œâ”€â”€ electron/         # Electron ä¸»è¿›ç¨‹ä»£ç 
â”‚   â”œâ”€â”€ main.js       # ä¸»è¿›ç¨‹å…¥å£
â”‚   â””â”€â”€ preload.cjs   # é¢„åŠ è½½è„šæœ¬
â”œâ”€â”€ scripts/          # æ„å»ºè„šæœ¬
â”‚   â””â”€â”€ dev-electron.js
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/          # API æ¥å£å±‚
â”‚   â”œâ”€â”€ assets/       # é™æ€èµ„æºï¼ˆCSSï¼‰
â”‚   â”œâ”€â”€ components/   # Vue ç»„ä»¶
â”‚   â”œâ”€â”€ composables/  # ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ router/       # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ store/        # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ player/   # æ’­æ”¾å™¨æ¨¡å—ï¼ˆé‡æ„åï¼‰
â”‚   â”‚       â”œâ”€â”€ constants/   # å¸¸é‡å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ helpers/     # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ core/        # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚       â”œâ”€â”€ modules/     # åŠŸèƒ½æ¨¡å—
â”‚   â”‚       â””â”€â”€ index.js     # ç»Ÿä¸€å…¥å£
â”‚   â”œâ”€â”€ views/        # é¡µé¢è§†å›¾
â”‚   â”œâ”€â”€ App.vue       # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.js       # å…¥å£æ–‡ä»¶
â”œâ”€â”€ server.js         # æœ¬åœ° API æœåŠ¡å…¥å£
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ vercel.json       # Vercel éƒ¨ç½²é…ç½®
â””â”€â”€ index.html
```

## ç¯å¢ƒæ”¯æŒ

æœ¬é¡¹ç›®æ”¯æŒä¸‰ç§è¿è¡Œç¯å¢ƒï¼š

| ç¯å¢ƒ | é€‚ç”¨åœºæ™¯ | API æœåŠ¡ | éƒ¨ç½²æ–¹å¼ |
|------|----------|----------|----------|
| **Web å¼€å‘** | æœ¬åœ°å¼€å‘è°ƒè¯•ï¼ˆChrome/Edge/Firefoxï¼‰ | æœ¬åœ° Node.js æœåŠ¡ | `npm run dev` |
| **Electron æ¡Œé¢** | Windows/Mac/Linux æ¡Œé¢åº”ç”¨ | å†…ç½®/æœ¬åœ°æœåŠ¡ | `npm run dev` æˆ– `npm run dev:electron` |
| **Vercel çº¿ä¸Š** | çº¿ä¸Š Web è®¿é—® | Vercel Serverless Function | è‡ªåŠ¨éƒ¨ç½² |

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- npm 9+

### å®‰è£…ä¾èµ–

```bash
cd luo_music
npm install
```

### NPM è„šæœ¬å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼
npm run dev              # å…¨éƒ¨å¼€å‘ï¼ˆAPI æœåŠ¡å™¨ + Viteï¼‰
npm run dev:web          # ä»… Web å¼€å‘ï¼ˆViteï¼‰
npm run dev:electron     # Electron å¼€å‘ï¼ˆæ¡Œé¢åº”ç”¨ï¼‰

# ç”Ÿäº§æ„å»º
npm run build:web        # è¾“å‡º dist/ â†’ éƒ¨ç½²åˆ° Vercel
npm run build:electron   # è¾“å‡º dist/ + release/ â†’ æœ¬åœ°å®‰è£…åŒ…

# å…¶ä»–å‘½ä»¤
npm run preview          # é¢„è§ˆæ„å»ºç»“æœ
npm run test             # è¿è¡Œæµ‹è¯•
npm run clean            # æ¸…ç†æ„å»ºäº§ç‰©
```

---

## ğŸŒ Web å¼€å‘ç¯å¢ƒ

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

**æ–¹å¼ä¸€ï¼šå…¨éƒ¨å¯åŠ¨ï¼ˆæ¨èï¼‰**
```bash
npm run dev
```
åŒæ—¶å¯åŠ¨ï¼š
- NeteaseCloudMusicApi æœåŠ¡ï¼ˆç«¯å£ 14532ï¼‰
- Vite å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 5173ï¼‰

**æ–¹å¼äºŒï¼šä»…å¯åŠ¨å‰ç«¯**
```bash
npm run dev:web
```
ä»…å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ï¼Œéœ€è¦å•ç‹¬å¯åŠ¨ API æœåŠ¡æˆ–ä½¿ç”¨è¿œç¨‹ APIã€‚

**æ–¹å¼ä¸‰ï¼šåˆ†åˆ«å¯åŠ¨ï¼ˆè°ƒè¯•æ—¶ä½¿ç”¨ï¼‰**
```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ API æœåŠ¡ (ç«¯å£ 14532)
npm run server

# ç»ˆç«¯ 2ï¼šå¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ (ç«¯å£ 5173)
npm run dev:web
```

### æ„å»º Web ç‰ˆæœ¬

```bash
npm run build:web
```

æ„å»ºè¾“å‡ºç›®å½•ï¼š`dist/`

---

## ğŸ’» Electron æ¡Œé¢ç¯å¢ƒ

### å¼€å‘æ¨¡å¼

```bash
npm run dev:electron
```

å¯åŠ¨å†…å®¹ï¼š
- NeteaseCloudMusicApi æœåŠ¡ï¼ˆç«¯å£ 14532ï¼‰
- Vite å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 5173ï¼‰
- Electron æ¡Œé¢åº”ç”¨çª—å£

### æ„å»ºæ¡Œé¢åº”ç”¨

```bash
# æ„å»ºå½“å‰å¹³å°
npm run build:electron

# ä½¿ç”¨ electron-builder ç›´æ¥æ„å»ºæŒ‡å®šå¹³å°
npx electron-builder --win
npx electron-builder --mac
npx electron-builder --linux
```

æ„å»ºè¾“å‡ºç›®å½•ï¼š`dist-electron/` å’Œ `release/`

### Electron ç‰¹æ€§

- **çª—å£æ§åˆ¶**ï¼šæ”¯æŒæœ€å°åŒ–ã€æœ€å¤§åŒ–ã€å…³é—­
- **ç´§å‡‘æ¨¡å¼**ï¼šæŒ‰ ESC é”®åˆ‡æ¢è¿·ä½ æ’­æ”¾å™¨
- **ç¼“å­˜ç®¡ç†**ï¼šåœ¨è®¾ç½®ä¸­æ¸…ç† Cookies å’Œç¼“å­˜æ•°æ®
- **ç³»ç»Ÿæ‰˜ç›˜**ï¼šæœ€å°åŒ–åˆ°æ‰˜ç›˜
- **å…¨å±€å¿«æ·é”®**ï¼šæ”¯æŒåª’ä½“é”®æ§åˆ¶

---

## â˜ï¸ Vercel çº¿ä¸Šéƒ¨ç½²

### è‡ªåŠ¨éƒ¨ç½²

1. Fork æœ¬é¡¹ç›®åˆ° GitHub
2. åœ¨ Vercel å¯¼å…¥é¡¹ç›®
3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰ï¼š
   - `VITE_API_BASE_URL` - API åŸºç¡€ URLï¼ˆé»˜è®¤ä½¿ç”¨ Vercel Serverless Functionï¼‰
4. éƒ¨ç½²å®Œæˆ

### Vercel é…ç½®è¯´æ˜

é¡¹ç›®å·²é…ç½®å¥½ `vercel.json`ï¼ŒåŒ…å«ï¼š
- API è·¯ç”±é‡å†™ï¼ˆ`/api/*` â†’ Serverless Functionï¼‰
- CORS è·¨åŸŸæ”¯æŒ
- é™æ€èµ„æºç¼“å­˜ç­–ç•¥
- 10 ç§’å‡½æ•°æ‰§è¡Œæ—¶é—´é™åˆ¶

### æœ¬åœ°é¢„è§ˆ Vercel æ„å»º

```bash
# å®‰è£… Vercel CLI
npm i -g vercel

# æœ¬åœ°é¢„è§ˆ
vercel dev
```

---

## âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼š

```bash
# API åŸºç¡€ URL
# Web å¼€å‘ï¼šhttp://localhost:14532
# Vercel éƒ¨ç½²ï¼š/apiï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰
VITE_API_BASE_URL=http://localhost:14532

# å¼€å‘æœåŠ¡å™¨ç«¯å£
VITE_DEV_SERVER_PORT=5173
```

---

## ğŸ”Œ API è¯´æ˜

### æœ¬åœ°å¼€å‘

å†…ç½®ç½‘æ˜“äº‘éŸ³ä¹ API æœåŠ¡ï¼ˆåŸºäº `NeteaseCloudMusicApi Enhanced`ï¼‰ï¼Œé»˜è®¤è¿è¡Œåœ¨ `http://localhost:14532`ã€‚

### Vercel éƒ¨ç½²

ä½¿ç”¨ Serverless Function è¿è¡Œ APIï¼Œè·¯å¾„ä¸º `/api/*`ã€‚

### ä¸»è¦ API ç«¯ç‚¹

| ç«¯ç‚¹ | è¯´æ˜ |
|------|------|
| `/search` | æ­Œæ›²æœç´¢ |
| `/cloudsearch` | æ­Œæ›²æœç´¢ï¼ˆæ›´å…¨ï¼‰ |
| `/song/url/v1` | è·å–éŸ³ä¹ URL |
| `/lyric` | è·å–æ­Œè¯ |
| `/song/detail` | æ­Œæ›²è¯¦æƒ… |
| `/playlist/detail` | æ­Œå•è¯¦æƒ… |

---

## ğŸ¨ è®¾è®¡é£æ ¼

é‡‡ç”¨å·¥ä¸šé£è®¾è®¡ï¼š
- **èƒŒæ™¯è‰²**: ç±³ç™½è‰² (#f5f5f0)
- **å¼ºè°ƒè‰²**: æ©™è‰² (#ff6b35)
- **è¾¹æ¡†**: ç²—é»‘è¾¹æ¡† (2px solid)
- **å­—ä½“**: Inter + Noto Sans SC + JetBrains Mono

---

## ğŸ’¾ çŠ¶æ€æŒä¹…åŒ–

ä»¥ä¸‹çŠ¶æ€ä¼šè‡ªåŠ¨æŒä¹…åŒ–åˆ° localStorageï¼š
- `volume` - éŸ³é‡è®¾ç½®
- `playMode` - æ’­æ”¾æ¨¡å¼
- `lyricType` - æ­Œè¯æ˜¾ç¤ºç±»å‹
- `isCompact` - ç´§å‡‘æ¨¡å¼çŠ¶æ€

**æ³¨æ„**ï¼šæ’­æ”¾åˆ—è¡¨å’Œå½“å‰ç´¢å¼•ä¸æŒä¹…åŒ–ï¼Œé¿å… URL è¿‡æœŸé—®é¢˜ã€‚

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: æœç´¢æç¤º "Search failed. Please check your connection"
**A**: æ£€æŸ¥ API æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`npm run server`ã€‚å¦‚æœæ˜¯ 502 é”™è¯¯ï¼Œå¯èƒ½æ˜¯ç½‘æ˜“äº‘éŸ³ä¹æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•ã€‚

### Q: æ­Œè¯ä¸æ˜¾ç¤ºæˆ–ä¸æ»šåŠ¨
**A**: 
1. æ£€æŸ¥æ˜¯å¦æœ‰ã€Œæ²‰æµ¸å¼ç¿»è¯‘ã€ç­‰æµè§ˆå™¨æ’ä»¶å¹²æ‰°
2. æ­Œè¯è§£ææ”¯æŒæ ‡å‡† LRC æ ¼å¼ï¼ŒåŒ…æ‹¬ `[00:00.00]` å’Œ `[00:00:00]` ä¸¤ç§æ—¶é—´æˆ³æ ¼å¼
3. ç¡®ä¿æ­Œæ›²æœ‰æ­Œè¯æ•°æ®

### Q: Electron åº”ç”¨æ— æ³•æ’­æ”¾éŸ³ä¹
**A**: æ£€æŸ¥ `webSecurity` è®¾ç½®ï¼Œç¡®ä¿éŸ³é¢‘è·¨åŸŸé…ç½®æ­£ç¡®ã€‚å¦‚æœæç¤º `preload.cjs` ç¼ºå¤±ï¼Œéœ€è¦é‡æ–°æ„å»ºï¼š`npm run build`ã€‚

### Q: Vercel éƒ¨ç½²å API è¶…æ—¶
**A**: Vercel å…è´¹ç‰ˆå‡½æ•°æ‰§è¡Œæ—¶é—´é™åˆ¶ä¸º 10 ç§’ï¼Œéƒ¨åˆ† API å¯èƒ½éœ€è¦é‡è¯•ã€‚

### Q: Vercel éƒ¨ç½²æ—¶å¦‚ä½•è·³è¿‡æµ‹è¯•ä¾èµ–å®‰è£…ï¼Ÿ
**A**: åœ¨ Vercel Dashboard ä¸­é…ç½®ï¼š
1. è¿›å…¥é¡¹ç›® â†’ **Settings** â†’ **General**
2. æ‰¾åˆ° **Build & Development Settings**
3. ä¿®æ”¹ **Install Command** ä¸ºï¼š`npm install --production`
4. æˆ–æ·»åŠ ç¯å¢ƒå˜é‡ï¼š`NODE_ENV = production`

è¿™æ · Vercel åªä¼šå®‰è£… `dependencies` ä¸­çš„ä¾èµ–ï¼Œè·³è¿‡ `devDependencies` ä¸­çš„æµ‹è¯•å·¥å…·ï¼ˆå¦‚ Playwrightã€Vitest ç­‰ï¼‰ï¼ŒåŠ å¿«éƒ¨ç½²é€Ÿåº¦ã€‚

### Q: å®‰è£…ä¾èµ–æ—¶æç¤º EBUSY é”™è¯¯
**A**: æ–‡ä»¶è¢«å ç”¨ï¼Œè¯·å…³é—­æ‰€æœ‰ Node.js å’Œ Electron è¿›ç¨‹ï¼Œæˆ–é‡å¯ç”µè„‘åé‡è¯•ã€‚

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Hydrogen Music](https://github.com/Kaidesuyo/Hydrogen-Music) - å‚è€ƒæ¶æ„è®¾è®¡
- [NeteaseCloudMusicApi Enhanced](https://github.com/NeteaseCloudMusicApiEnhanced/api-enhanced) - ç½‘æ˜“äº‘éŸ³ä¹ APIï¼ˆå¢å¼ºç‰ˆï¼ŒæŒç»­ç»´æŠ¤ï¼‰
- [Electron æ–‡æ¡£](https://www.electronjs.org/)
- [Vue 3 æ–‡æ¡£](https://vuejs.org/)
- [Vercel æ–‡æ¡£](https://vercel.com/docs)
