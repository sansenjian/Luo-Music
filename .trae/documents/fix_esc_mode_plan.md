# ESC 切换模式问题修复计划

## 1. 问题分析
用户反馈按下 ESC 键切换到紧凑模式（Mini 播放条模式）后出现“白屏”或其他严重问题。经过代码审查，可能存在以下原因：

### 1.1 布局塌陷与白屏
*   **原因**：在 `Home.vue` 中，当 `.window` 添加 `compact-mode` 类时，我们将 `.main` 的子元素（`.left-panel` 和 `.right-panel`）隐藏了，但可能没有正确处理 `.main` 容器本身的高度或布局，导致页面内容为空。
*   **CSS 问题**：如果 `.window` 设置了 `background: transparent`，而 `.compact-player` 没有设置正确的背景色或定位，可能会导致看起来像白屏（实际上是透明或空）。

### 1.2 窗口尺寸调整冲突
*   **逻辑**：`handleKeydown` 中同时触发了 `playerStore.toggleCompactMode()`（状态变更）和 `ipcRenderer.send('resize-window')`（窗口调整）。
*   **风险**：如果渲染进程的布局响应比窗口调整慢，或者窗口调整后内容溢出/不可见，会导致视觉错乱。

### 1.3 状态同步
*   **状态**：`playerStore.isCompact` 控制了 Vue 层的渲染，而窗口大小由 Electron 主进程控制。如果两者不同步（例如用户手动拖拽改变了窗口大小），再次按 ESC 可能会导致尺寸逻辑混乱。

## 2. 修复方案

### 2.1 优化 CSS 布局逻辑
*   **目标**：确保在 `compact-mode` 下，`.window` 容器只显示底部的播放条，其余部分彻底隐藏且不占空间。
*   **修改**：
    *   明确 `.window.compact-mode` 的布局方式，使用 Flex 布局将内容推到底部。
    *   确保 `.compact-player` 有固定的高度、背景色（白色）和边框，防止在透明窗口中不可见。
    *   修复 `.main` 的隐藏方式，使用 `display: none` 而不是仅仅隐藏子元素，避免占位。

### 2.2 完善 Electron 窗口控制
*   **目标**：确保窗口在切换模式时能准确地在“完整尺寸”和“迷你尺寸”之间切换。
*   **修改**：
    *   在 `main.js` 中，确保 `resize-window` 可以接受并执行尺寸变更。
    *   在 `Home.vue` 中，优化 `handleKeydown` 逻辑，确保先调整窗口大小，再更新 UI（或反之，视视觉效果而定，通常同步进行）。

### 2.3 增强容错性
*   **措施**：
    *   给 `.window` 添加默认背景色，避免完全透明导致的视觉困惑。
    *   确保 ESC 键的事件监听不会被重复触发或失效。

## 3. 执行步骤

1.  **修改 `src/views/Home.vue`**：
    *   重构 CSS，确保 `compact-mode` 下的布局逻辑清晰。
    *   特别是 `.compact-player` 的样式，确保它是唯一可见的元素。
2.  **检查 `electron/main.js`**：
    *   确认 `resize-window` IPC 监听器是否存在且正确。
3.  **验证**：
    *   重启应用。
    *   测试 ESC 切换，观察窗口尺寸变化和内容显示。

## 4. 预期结果
*   **正常模式**：1200x800 窗口，显示完整界面。
*   **ESC 迷你模式**：窗口瞬间缩小为 800x80（长条状），界面只显示底部的播放控制条，无白屏，无多余空白。
